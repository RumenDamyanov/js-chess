services:
  # Go-chess backend API
  chess-backend:
    build:
      context: ./backend/go-chess
      dockerfile: Dockerfile
    container_name: chess-backend
    ports:
      - "8080:8080"
    environment:
      - CHESS_HOST=0.0.0.0
      - CHESS_PORT=8080
      - CHESS_LOG_LEVEL=info
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
    networks:
      - chess-network

  # Landing page with app showcase
  chess-landing:
    build:
      context: .
      dockerfile: ./apps/landing/Dockerfile
    container_name: chess-landing
    ports:
      - "3000:80"
    depends_on:
      - chess-backend
    networks:
      - chess-network

  # Vanilla JavaScript app
  chess-vanilla:
    build:
      context: .
      dockerfile: ./apps/vanilla-js/Dockerfile
    container_name: chess-vanilla
    ports:
      - "3001:80"
    depends_on:
      - chess-backend
    networks:
      - chess-network

  # Vanilla TypeScript app
  chess-vanilla-ts:
    build:
      context: .
      dockerfile: ./apps/vanilla-ts/Dockerfile
    container_name: chess-vanilla-ts
    ports:
      - "3002:80"
    depends_on:
      - chess-backend
    networks:
      - chess-network

  # jQuery app
  chess-jquery:
    build:
      context: .
      dockerfile: ./apps/jquery/Dockerfile
    container_name: chess-jquery
    ports:
      - "3003:80"
    depends_on:
      - chess-backend
    networks:
      - chess-network

  # Vue.js app
  chess-vue:
    build:
      context: .
      dockerfile: ./apps/vue-js/Dockerfile
      args:
        - BUILDKIT_INLINE_CACHE=1
    container_name: chess-vue
    ports:
      - "3004:80"
    environment:
      - VITE_API_URL=http://localhost:8080
      - VITE_WS_URL=ws://localhost:8080
    depends_on:
      - chess-backend
    networks:
      - chess-network

  # React.js app
  chess-react:
    build:
      context: .
      dockerfile: ./apps/react-js/Dockerfile
    container_name: chess-react
    ports:
      - "3005:80"
    environment:
      - VITE_API_URL=http://localhost:8080
      - VITE_WS_URL=ws://localhost:8080
    depends_on:
      - chess-backend
    networks:
      - chess-network

  # Angular app
  chess-angular:
    build:
      context: .
      dockerfile: ./apps/angular/Dockerfile
    container_name: chess-angular
    ports:
      - "3006:80"
    environment:
      - API_URL=http://localhost:8080
      - WS_URL=ws://localhost:8080
    depends_on:
      - chess-backend
    networks:
      - chess-network

  # Nginx reverse proxy (optional, for advanced routing)
  nginx:
    build:
      context: ./docker/nginx
      dockerfile: Dockerfile
    container_name: chess-nginx
    ports:
      - "80:80"
    depends_on:
      - chess-landing
      - chess-vanilla
      - chess-vanilla-ts
      - chess-jquery
      - chess-vue
      - chess-react
      - chess-angular
    networks:
      - chess-network
    profiles:
      - nginx

networks:
  chess-network:
    driver: bridge
